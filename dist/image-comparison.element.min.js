var it=`<html><head></head><body><div class="container"> <ul class="tab-list"> <li><label> <input type="radio" name="tab" value="side-by-side" checked=""> side by side </label></li> <li><label> <input type="radio" name="tab" value="slider"> slider </label></li> <li><label> <input type="radio" name="tab" value="diff"> pixel difference </label></li> </ul> <div class="tab side-by-side"> <figure> <img class="left-side"> <figcaption class="caption--left-side"></figcaption> </figure> <figure> <img class="right-side"> <figcaption class="caption--right-side"></figcaption> </figure> </div> <div class="tab slider"> <div class="comparison-slider"> <div class="overlay caption--right-side"></div> <img class="right-side"> <div class="resize"> <div class="overlay caption--left-side"></div> <img class="left-side"> </div> <div class="divider"></div> </div> </div> <div class="tab diff"> <canvas class="diff-image"></canvas> </div>
</div>
</body></html>`;var at=`:host{--bg-color: #e5e5e5;--bg-code-color: #f3f3f3;--bg-sidebar-color: #ddd;--sidebar-border-color: #0002;--bg-color-active: #edecef;--fg-color: #303540;--fg-color-disabled: #404550;--resizable-border-color: #303540;--tab-active-color: #007299;--antialias-diff-color: yellow }@media (prefers-color-scheme: dark){:host{--bg-color: #202530;--bg-code-color: #303540;--bg-sidebar-color: #303540;--sidebar-border-color: #fff2;--bg-color-active: #292d30;--fg-color: #dddcdf;--fg-color-disabled: #ccc;--resizable-border-color: #dddcdf;--tab-active-color: #fa5;--even-tr-bg: #ffffff08}}.tab{display:none}.tab-list{padding:1em;list-style-type:none;display:flex;justify-content:space-around;label{padding:1em;width:30%;text-align:center;&:has(input:checked),&:hover{background:var(--bg-color-active);cursor:pointer}}input{appearance:none;display:none}}.container:has(.tab-list input[value=side-by-side]:checked)>.tab.side-by-side{display:flex;gap:10px}.container:has(.tab-list input[value=slider]:checked)>.tab.slider,.container:has(.tab-list input[value=diff]:checked)>.tab.diff{display:block}.tab.side-by-side>figure{margin:0}.tab.side-by-side figcaption{text-align:center}canvas{width:100%}.comparison-slider{position:relative;width:100%;margin:0;border:5px white solid;box-sizing:border-box;>img{width:100%;height:auto;display:block}&:hover .overlay{display:block}.overlay:empty{display:none}.overlay{position:absolute;width:250px;bottom:20px;right:20px;background-color:#0006;padding:10px;box-sizing:border-box;color:#ddd;text-align:right}.resize{position:absolute;top:0;left:0;height:100%;width:50%;overflow:hidden;>img{display:block}.overlay{right:auto;left:20px;text-align:left}}.divider{position:absolute;touch-action:none;width:2px;height:100%;background-color:#fff3;left:50%;top:0;bottom:0;margin-left:-1px;cursor:ew-resize;&:before{content:"";position:absolute;width:20px;height:20px;left:-9px;top:50%;margin-top:-10px;background-color:#fff;transform:rotate(45deg);transition:all .1s ease-in-out}&:after{content:"";position:absolute;width:12px;height:12px;left:-5px;top:50%;margin-top:-6px;background-color:#fff;transform:rotate(45deg);transition:all .1s ease-in-out}&.dragging{&:before{width:30px;height:30px;left:-14px;margin-top:-15px}&:after{width:20px;height:20px;left:-9px;margin-top:-10px;background-color:#555}}}}
`;function k(e,t,o,n,r,i,a){if(n<255){n/=255;let s=1-n;return{R:r*s+e*n,G:i*s+t*n,B:a*s+o*n}}return{R:e,G:t,B:o}}var{sqrt:z,pow:y,cos:O,atan2:Gt,sin:st,abs:U,exp:_t,PI:ct,hypot:Y}=Math;function ft(e,t){let o=e.L,n=e.a,r=e.b,i=t.L,a=t.a,s=t.b,c=1,l=1,d=1,f=Y(n,r),u=Y(a,s),p=(f+u)/2,g=.5*(1-z(y(p,7)/(y(p,7)+25**7))),m=(1+g)*n,b=(1+g)*a,A=Y(m,r),h=Y(b,s),x=lt(r,m),w=lt(s,b),P=i-o,G=h-A,v=Lt(f,u,x,w),C=2*z(A*h)*st(E(v)/2),S=(o+i)/2,_=(A+h)/2,L=kt(f,u,x,w),St=1-.17*O(E(L-30))+.24*O(E(2*L))+.32*O(E(3*L+6))-.2*O(E(4*L-63)),Et=30*_t(-y((L-275)/25,2)),Bt=z(y(_,7)/(y(_,7)+y(25,7))),Dt=1+.015*y(S-50,2)/z(20+y(S-50,2)),nt=1+.045*_,rt=1+.015*_*St,It=-2*Bt*st(E(2*Et));return z(y(P/(Dt*c),2)+y(G/(nt*l),2)+y(C/(rt*d),2)+It*(G/(nt*l))*(C/(rt*d)))}function lt(e,t){if(e===0&&t===0)return 0;{let o=zt(Gt(e,t));return o>=0?o:o+360}}function Lt(e,t,o,n){if(e*t===0)return 0;if(U(n-o)<=180)return n-o;if(n-o>180)return n-o-360;if(n-o<-180)return n-o+360;throw new Error}function kt(e,t,o,n){if(e*t===0)return o+n;if(U(o-n)<=180)return(o+n)/2;if(U(o-n)>180&&o+n<360)return(o+n+360)/2;if(U(o-n)>180&&o+n>=360)return(o+n-360)/2;throw new Error}function zt(e){return e*(180/ct)}function E(e){return e*(ct/180)}var B=Math.pow;function X(e){return qt(Mt(e))}function Mt(e){let t=e.R/255,o=e.G/255,n=e.B/255;t>.04045?t=B((t+.055)/1.055,2.4):t=t/12.92,o>.04045?o=B((o+.055)/1.055,2.4):o=o/12.92,n>.04045?n=B((n+.055)/1.055,2.4):n=n/12.92,t*=100,o*=100,n*=100;let r=t*.4124+o*.3576+n*.1805,i=t*.2126+o*.7152+n*.0722,a=t*.0193+o*.1192+n*.9505;return{X:r,Y:i,Z:a}}function qt(e){let r=e.Y/100,i=e.Z/108.883,a=e.X/95.047;a>.008856?a=B(a,1/3):a=7.787*a+16/116,r>.008856?r=B(r,1/3):r=7.787*r+16/116,i>.008856?i=B(i,1/3):i=7.787*i+16/116;let s=116*r-16,c=500*(a-r),l=200*(r-i);return{L:s,a:c,b:l}}var{sqrt:Q}=Math;function H(e,t,o,n,r,i){let a=e-n,s=t-r,c=o-i;return Q(a*a+s*s+c*c)}function W(e,t,o,n,r,i){let a=X({R:e,G:t,B:o}),s=X({R:n,G:r,B:i});return ft(a,s)}function F(e,t,o,n,r,i){let a=(e+n)/2,s=e-n,c=t-r,l=o-i;return Q((2+a/256)*s*s+4*c*c+(2+(255-a)/256)*l*l)}function Z(e,t,o,n,r,i){let a=D(e,t,o)-D(n,r,i),s=dt(e,t,o)-dt(n,r,i),c=ut(e,t,o)-ut(n,r,i);return Q(a*a*.5053+s*s*.299+c*c*.1957)}function j(e,t,o,n,r,i){return D(e,t,o)-D(n,r,i)}function D(e,t,o){return e*.29889531+t*.58662247+o*.11448223}function dt(e,t,o){return e*.59597799-t*.2741761-o*.32180189}function ut(e,t,o){return e*.21147017-t*.52261711+o*.31114694}var R=e=>+e.toFixed(5),T={YIQ:R(Z(0,0,0,255,255,255)),RGB:R(H(0,0,0,255,255,255)),RieRGB:R(F(0,0,0,255,255,255)),CIEDE2000:R(W(0,0,0,255,255,255)),Brightness:R(Math.abs(j(0,0,0,255,255,255)))},V=Object.freeze(["YIQ","CIEDE2000","RGB","RieRGB","Brightness"]);function $(e,t,o,n,r){let i=e[o+0],a=e[o+1],s=e[o+2],c=e[o+3],l=t[n+0],d=t[n+1],f=t[n+2],u=t[n+3];return Pt(i,a,s,c,l,d,f,u,r)}function Pt(e,t,o,n,r,i,a,s,c){if(c=Object.hasOwn(T,c)?c:"CIEDE2000",n===s&&e===r&&t===i&&o===a)return{delta:0,maxDelta:T[c]};let l=(()=>{switch(c){case"YIQ":return Z;case"RGB":return H;case"RieRGB":return F;case"Brightness":return j;case"CIEDE2000":default:return W}})();if(n<255||s<255){let f=k(e,t,o,n,255,255,255),u=k(r,i,a,s,255,255,255),p=R(l(f.R,f.G,f.B,u.R,u.G,u.B)),g=k(e,t,o,n,0,0,0),m=k(r,i,a,s,0,0,0),b=R(l(g.R,g.G,g.B,m.R,m.G,m.B));return{delta:Math.max(p,b),maxDelta:T[c]}}return{delta:R(l(e,t,o,r,i,a)),maxDelta:T[c]}}var Ot=function(e){let t={};return function(o){return o in t||(t[o]=e(o)),t[o]}},pt=function(){let e=new OffscreenCanvas(1,1);e.width=e.height=1;let t=e.getContext("2d");if(!t)throw Error("unreachable code");return Ot(function(n){t.clearRect(0,0,1,1),t.fillStyle="#000",t.fillStyle=n;let r=t.fillStyle;if(t.fillStyle="#fff",t.fillStyle=n,r===t.fillStyle)return t.fillRect(0,0,1,1),[...t.getImageData(0,0,1,1).data]})}();function M(e,t){let o=pt(t);if(!o)throw new Error(`Invalid fallbackColor ${t!=null?JSON.stringify(t):t}`);return pt(e)||o}var gt="yellow",bt="red";function Yt({img1:e,img2:t,width:o,height:n,algorithm:r="CIEDE2000"}){if(tt({img1:e,img2:t,width:o,height:n}),!V.includes(r))throw new Error(`Invalid algorithm ${r}, expected algorithms: ${V.join(", ")}.`);let i=o*n,a=new Uint8Array(i),s=new Uint32Array(e.buffer,e.byteOffset,i),c=new Uint32Array(t.buffer,t.byteOffset,i),l=!0;for(let d=0;d<i;d++){if(s[d]===c[d])continue;let f=d*4,{delta:u,maxDelta:p}=$(e,t,f,f,r);a[d]=Math.ceil(Math.abs(u)*100/p),l=!1}return{identical:l,diffMap:a}}function Ut(e){tt(e);let{img1:t,img2:o,width:n,height:r}=e,i=n*r,a=new Uint8Array(i),s=new Uint32Array(t.buffer,t.byteOffset,i),c=new Uint32Array(o.buffer,o.byteOffset,i);for(let l=0;l<r;l++)for(let d=0;d<n;d++){let f=l*n+d;s[f]===c[f]?a[f]=128:mt(t,d,l,n,r,o)||mt(o,d,l,n,r,t)?a[f]=193:a[f]=192}return a}function xt({img1:e,img2:t,output:o,antialiasOutput:n,width:r,height:i,threshold:a=10,antialias:s=!1,aaColor:c=gt,diffColor:l=bt,diffMask:d=!1,alpha:f=.1}){if(n??=o,tt({img1:e,img2:t,width:r,height:i,output:o}),e.length!==t.length||o&&o.length!==e.length||n&&n.length!==e.length)throw new Error("Image sizes do not match.");let{identical:u,diffMap:p}=Yt({img1:e,img2:t,width:r,height:i,algorithm:"CIEDE2000"});if(u){if(o&&!d)for(let v=0,C=r*i;v<C;v++)ht(e,4*v,f,o);return{diffPixelAmount:0,aaPixelAmount:0}}let g=s?Ut({img1:e,img2:t,width:r,height:i}):null,[m,b,A]=M(c,gt),[h,x,w]=M(l,bt),P=0,G=0;for(let v=0;v<i;v++)for(let C=0;C<r;C++){let S=(v*r+C)*4;p[v*r+C]>a?g&&(g[v*r+C]&1)===1?(n&&K(n,S,m,b,A),G++):(o&&K(o,S,h,x,w),P++):o&&!d&&ht(e,S,f,o)}return{diffPixelAmount:P,aaPixelAmount:G}}function J(e){return e instanceof Uint8Array||e instanceof Uint8ClampedArray}function mt(e,t,o,n,r,i){let a=Math.max(t-1,0),s=Math.max(o-1,0),c=Math.min(t+1,n-1),l=Math.min(o+1,r-1),d=(o*n+t)*4,f=t===a||t===c||o===s||o===l?1:0,u=0,p=0,g=n,m=r,b=0,A=0;for(let h=a;h<=c;h++)for(let x=s;x<=l;x++){if(h===t&&x===o)continue;let{delta:w}=$(e,e,d,(x*n+h)*4,"Brightness");if(w===0){if(f++,f>2)return!1}else w<u?(u=w,g=h,m=x):w>p&&(p=w,b=h,A=x)}return u===0||p===0?!1:N(e,g,m,n,r)&&N(i,g,m,n,r)||N(e,b,A,n,r)&&N(i,b,A,n,r)}function N(e,t,o,n,r){let i=Math.max(t-1,0),a=Math.max(o-1,0),s=Math.min(t+1,n-1),c=Math.min(o+1,r-1),l=(o*n+t)*4,d=t===i||t===s||o===a||o===c?1:0;for(let f=i;f<=s;f++)for(let u=a;u<=c;u++){if(f===t&&u===o)continue;let p=(u*n+f)*4;if(e[l]===e[p]&&e[l+1]===e[p+1]&&e[l+2]===e[p+2]&&e[l+3]===e[p+3]&&d++,d>2)return!0}return!1}function K(e,t,o,n,r){e[t+0]=o,e[t+1]=n,e[t+2]=r,e[t+3]=255}function ht(e,t,o,n){let r=e[t+0],i=e[t+1],a=e[t+2],s=o*e[t+3]/255,l=255+(D(r,i,a)-255)*s;K(n,t,l,l,l)}function tt({img1:e,img2:t,width:o,height:n,output:r}){if(!J(e)||!J(t)||r&&!J(r))throw new Error("Image data: Uint8Array or Uint8ClampedArray expected.");if(e.length!==t.length)throw new Error("Image sizes do not match.");if(e.length!==o*n*4)throw new Error("Image data size does not match width/height.")}var yt=()=>{let e=document.createElement("template");return e.innerHTML=it,yt=()=>e,e},wt=()=>{let e=new CSSStyleSheet;return e.replaceSync(at),wt=()=>e,e},et="img.left-side",ot="img.right-side",Tt=new IntersectionObserver(e=>{for(let t of e)At(t.target)}),Nt=new IntersectionObserver(e=>{for(let t of e){let o=t.target.getRootNode();if(!(o instanceof ShadowRoot))return;let{host:n}=o;if(!(n instanceof I))return;Ct(n)}}),Xt=new ResizeObserver(e=>{for(let t of e)At(t.target)}),q=new WeakMap,I=class extends HTMLElement{constructor(){super();let t=this.attachShadow({mode:"open"});t.adoptedStyleSheets=[wt()];let o=yt();t.append(document.importNode(o.content,!0));let n=t.querySelector(".comparison-slider");n&&(Qt(n),Tt.observe(n),Xt.observe(n),t.querySelector(et)?.addEventListener("load",()=>this.updateCanvas()),t.querySelector(ot)?.addEventListener("load",()=>this.updateCanvas()),q.set(this,{}))}connectedCallback(){let t=this.shadowRoot;if(!t)return;let o=this.querySelectorAll(":scope > img, :scope > figure > img");if(o.length>0){let n=o[0];if(n.parentElement?.matches("figure")){let r=n.parentElement?.querySelector(":scope > figcaption")?.textContent;t.querySelectorAll(".caption--left-side").forEach(i=>{i.textContent=r??""})}t.querySelectorAll(et).forEach(r=>{r.src=n.src})}if(o.length>1){let n=o[1];if(n.parentElement?.matches("figure")){let r=n.parentElement?.querySelector(":scope > figcaption")?.textContent;t.querySelectorAll(".caption--right-side").forEach(i=>{i.textContent=r??""})}t.querySelectorAll(ot).forEach(r=>{r.src=n.src})}}updateCanvas(){let{shadowRoot:t}=this;t&&t.querySelectorAll("canvas.diff-image").forEach(o=>{let n=t.querySelector(et),r=t.querySelector(ot);if(!vt(n)||!vt(r))return;let i=n.naturalWidth,a=n.naturalHeight;o.width=i,o.height=a;let c=new OffscreenCanvas(i,a).getContext("2d"),d=new OffscreenCanvas(i,a).getContext("2d"),f=o.getContext("2d");if(!c||!d||!f)return;c?.drawImage(n,0,0),d?.drawImage(r,0,0);let u=c.getImageData(0,0,i,a),p=d.getImageData(0,0,i,a),g=f.createImageData(i,a,{colorSpace:"srgb"}),m=new Uint8ClampedArray(i*a*4),b=q.get(this);b.aaData=m,b.appliedAAColor=null,b.diffs=xt({img1:u.data,img2:p.data,output:g.data,antialiasOutput:m,aaColor:"black",width:i,height:a,antialias:this.antialias}),this.setAttribute("data-diff-pixels",b.diffs.diffPixelAmount.toString()),this.antialias&&this.setAttribute("data-diff-antialias",b.diffs.aaPixelAmount.toString()),f.putImageData(g,0,0),Ct(this),Nt.observe(o)})}get diffPixelsAmount(){return q.get(this).diffPixelAmount??NaN}get antialiasedPixelsAmount(){return q.get(this).aaPixelAmount??NaN}get antialias(){return this.hasAttribute("data-antialias")}set antialias(t){this.toggleAttribute("data-antialias",!!t)}};function Ct(e){let t=q.get(e),o=t.aaData,n=t.appliedAAColor;if(!o)return;let r=getComputedStyle(e).getPropertyValue("--antialias-diff-color");if(r===n)return;let{shadowRoot:i}=e;i&&i.querySelectorAll("canvas.diff-image").forEach(a=>{let s=a.getContext("2d");if(!s)return;let c=s.getImageData(0,0,a.width,a.height,{colorSpace:"srgb"}),l=M(r,"yellow");for(let d=0,f=o.length;d<f;d+=4)if(o[d+3]>0){let{data:u}=c;u[d]=l[0],u[d+1]=l[1],u[d+2]=l[2],u[d+3]=l[3]}t.appliedAAColor=r,s.putImageData(c,0,0)})}function vt(e){return e!=null&&e.complete&&e.naturalWidth!==0}function At(e){let t=e.querySelector(":scope > img"),o=e.querySelector(".resize img");if(!o||!t)return;let n=t.getBoundingClientRect().width+"px";o.style.width=n}function Qt(e){let t=e.querySelector("div.divider"),o=e.querySelector("div.resize");if(!t||!o)return;let n=0,r=0,i=0,a=0,s=0,c=function(l){l.pointerType==="mouse"&&l.preventDefault();let f=l.clientX-n;f<a?f=a:f>s&&(f=s);let u=(f+n/2-r)*100/i+"%";t.style.left=u,o.style.width=u};t.addEventListener("pointerdown",()=>{t.classList.add("dragging"),n=t.getBoundingClientRect().width,r=e.getBoundingClientRect().left,i=e.getBoundingClientRect().width,a=r+10,s=r+i-n-10,window.addEventListener("pointermove",c),window.addEventListener("pointerup",()=>{t.classList.remove("dragging"),window.removeEventListener("pointermove",c)},{once:!0})})}var Ht=new URL(import.meta.url),Rt=Ht.searchParams.get("named")?.trim();Rt&&customElements.define(Rt,I);var Wt=I,be=Wt;export{Wt as ImageComparisonElement,be as default};
//# sourceMappingURL=image-comparison.element.min.js.map
