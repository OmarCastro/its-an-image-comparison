var lt=`<html><head></head><body><div class="container"> <ul class="tab-list"> <li><label> <input type="radio" name="tab" value="side-by-side" checked=""> side by side </label></li> <li><label> <input type="radio" name="tab" value="slider"> slider </label></li> <li><label> <input type="radio" name="tab" value="diff"> pixel difference </label></li> </ul> <div class="tab side-by-side"> <figure> <img class="left-side"> <figcaption class="caption--left-side"></figcaption> </figure> <figure> <img class="right-side"> <figcaption class="caption--right-side"></figcaption> </figure> </div> <div class="tab slider"> <div class="comparison-slider"> <div class="overlay caption--right-side"></div> <img class="right-side"> <div class="resize"> <div class="overlay caption--left-side"></div> <img class="left-side"> </div> <div class="divider"></div> </div> </div> <div class="tab diff"> <canvas class="diff-image"></canvas> </div>
</div>
</body></html>`;var ct=`:host{--bg-color: #e5e5e5;--bg-code-color: #f3f3f3;--bg-sidebar-color: #ddd;--sidebar-border-color: #0002;--bg-color-active: #edecef;--fg-color: #303540;--fg-color-disabled: #404550;--resizable-border-color: #303540;--tab-active-color: #007299;--antialias-diff-color: yellow;--diff-color: red;transition:--antialias-diff-color 1ms step-start allow-discrete,--diff-color 1ms step-start allow-discrete}@media (prefers-color-scheme: dark){:host{--bg-color: #202530;--bg-code-color: #303540;--bg-sidebar-color: #303540;--sidebar-border-color: #fff2;--bg-color-active: #292d30;--fg-color: #dddcdf;--fg-color-disabled: #ccc;--resizable-border-color: #dddcdf;--tab-active-color: #fa5;--even-tr-bg: #ffffff08}}.tab{display:none}.tab-list{padding:1em;list-style-type:none;display:flex;justify-content:center;label{padding:1em;width:30%;text-align:center;&:has(input:checked),&:hover{background:var(--bg-color-active);cursor:pointer}}input{appearance:none;display:none}}.container:has(.tab-list input[value=side-by-side]:checked)>.tab.side-by-side{display:flex;gap:10px;justify-content:space-around}.container:has(.tab-list input[value=slider]:checked)>.tab.slider,.container:has(.tab-list input[value=diff]:checked)>.tab.diff{display:flex;justify-content:center}.tab.side-by-side>figure{margin:0}.tab.side-by-side figcaption{text-align:center}.comparison-slider{position:relative;max-width:100%;margin:0;border:5px white solid;box-sizing:border-box;>img{width:100%;height:auto;display:block}&:hover .overlay{display:block}.overlay:empty{display:none}.overlay{position:absolute;max-width:250px;bottom:20px;right:0;background-color:#0006;padding:10px;box-sizing:border-box;color:#ddd;text-align:right}.resize{position:absolute;top:0;left:0;height:100%;width:50%;overflow:hidden;>img{display:block}.overlay{right:auto;text-align:left;text-wrap:nowrap}}.divider{position:absolute;touch-action:none;width:2px;height:100%;background-color:#fff3;left:50%;top:0;bottom:0;margin-left:-1px;cursor:ew-resize;&:before{content:"";position:absolute;width:20px;height:20px;left:-9px;top:50%;margin-top:-10px;background-color:#fff;transform:rotate(45deg);transition:all .1s ease-in-out}&:after{content:"";position:absolute;width:12px;height:12px;left:-5px;top:50%;margin-top:-6px;background-color:#fff;transform:rotate(45deg);transition:all .1s ease-in-out}&.dragging{&:before{width:30px;height:30px;left:-14px;margin-top:-15px}&:after{width:20px;height:20px;left:-9px;margin-top:-10px;background-color:#555}}}}
`;function q(e,t,o,n,r,i,a){if(n<255){n/=255;let s=1-n;return{R:r*s+e*n,G:i*s+t*n,B:a*s+o*n}}return{R:e,G:t,B:o}}var{sqrt:P,pow:w,cos:Y,atan2:Gt,sin:ft,abs:X,exp:Lt,PI:ut,hypot:U}=Math;function pt(e,t){let o=e.L,n=e.a,r=e.b,i=t.L,a=t.a,s=t.b,c=1,f=1,u=1,l=U(n,r),d=U(a,s),b=(l+d)/2,p=.5*(1-P(w(b,7)/(w(b,7)+25**7))),g=(1+p)*n,m=(1+p)*a,A=U(g,r),y=U(m,s),v=dt(r,g),C=dt(s,m),_=i-o,L=y-A,h=kt(l,d,v,C),x=2*P(A*y)*ft(B(h)/2),R=(o+i)/2,k=(A+y)/2,z=zt(l,d,v,C),St=1-.17*Y(B(z-30))+.24*Y(B(2*z))+.32*Y(B(3*z+6))-.2*Y(B(4*z-63)),Rt=30*Lt(-w((z-275)/25,2)),Bt=P(w(k,7)/(w(k,7)+w(25,7))),Dt=1+.015*w(R-50,2)/P(20+w(R-50,2)),at=1+.045*k,st=1+.015*k*St,It=-2*Bt*ft(B(2*Rt));return P(w(_/(Dt*c),2)+w(L/(at*f),2)+w(x/(st*u),2)+It*(L/(at*f))*(x/(st*u)))}function dt(e,t){if(e===0&&t===0)return 0;{let o=qt(Gt(e,t));return o>=0?o:o+360}}function kt(e,t,o,n){if(e*t===0)return 0;if(X(n-o)<=180)return n-o;if(n-o>180)return n-o-360;if(n-o<-180)return n-o+360;throw new Error}function zt(e,t,o,n){if(e*t===0)return o+n;if(X(o-n)<=180)return(o+n)/2;if(X(o-n)>180&&o+n<360)return(o+n+360)/2;if(X(o-n)>180&&o+n>=360)return(o+n-360)/2;throw new Error}function qt(e){return e*(180/ut)}function B(e){return e*(ut/180)}var D=Math.pow;function Q(e){return Mt(Pt(e))}function Pt(e){let t=e.R/255,o=e.G/255,n=e.B/255;t>.04045?t=D((t+.055)/1.055,2.4):t=t/12.92,o>.04045?o=D((o+.055)/1.055,2.4):o=o/12.92,n>.04045?n=D((n+.055)/1.055,2.4):n=n/12.92,t*=100,o*=100,n*=100;let r=t*.4124+o*.3576+n*.1805,i=t*.2126+o*.7152+n*.0722,a=t*.0193+o*.1192+n*.9505;return{X:r,Y:i,Z:a}}function Mt(e){let r=e.Y/100,i=e.Z/108.883,a=e.X/95.047;a>.008856?a=D(a,1/3):a=7.787*a+16/116,r>.008856?r=D(r,1/3):r=7.787*r+16/116,i>.008856?i=D(i,1/3):i=7.787*i+16/116;let s=116*r-16,c=500*(a-r),f=200*(r-i);return{L:s,a:c,b:f}}var{sqrt:W}=Math;function j(e,t,o,n,r,i){let a=e-n,s=t-r,c=o-i;return W(a*a+s*s+c*c)}function F(e,t,o,n,r,i){let a=Q({R:e,G:t,B:o}),s=Q({R:n,G:r,B:i});return pt(a,s)}function Z(e,t,o,n,r,i){let a=(e+n)/2,s=e-n,c=t-r,f=o-i;return W((2+a/256)*s*s+4*c*c+(2+(255-a)/256)*f*f)}function V(e,t,o,n,r,i){let a=I(e,t,o)-I(n,r,i),s=gt(e,t,o)-gt(n,r,i),c=bt(e,t,o)-bt(n,r,i);return W(a*a*.5053+s*s*.299+c*c*.1957)}function $(e,t,o,n,r,i){return I(e,t,o)-I(n,r,i)}function I(e,t,o){return e*.29889531+t*.58662247+o*.11448223}function gt(e,t,o){return e*.59597799-t*.2741761-o*.32180189}function bt(e,t,o){return e*.21147017-t*.52261711+o*.31114694}var E=e=>+e.toFixed(5),N={YIQ:E(V(0,0,0,255,255,255)),RGB:E(j(0,0,0,255,255,255)),RieRGB:E(Z(0,0,0,255,255,255)),CIEDE2000:E(F(0,0,0,255,255,255)),Brightness:E(Math.abs($(0,0,0,255,255,255)))},J=Object.freeze(["YIQ","CIEDE2000","RGB","RieRGB","Brightness"]);function K(e,t,o,n,r){let i=e[o+0],a=e[o+1],s=e[o+2],c=e[o+3],f=t[n+0],u=t[n+1],l=t[n+2],d=t[n+3];return Ot(i,a,s,c,f,u,l,d,r)}function Ot(e,t,o,n,r,i,a,s,c){if(c=Object.hasOwn(N,c)?c:"CIEDE2000",n===s&&e===r&&t===i&&o===a)return{delta:0,maxDelta:N[c]};let f=(()=>{switch(c){case"YIQ":return V;case"RGB":return j;case"RieRGB":return Z;case"Brightness":return $;case"CIEDE2000":default:return F}})();if(n<255||s<255){let l=q(e,t,o,n,255,255,255),d=q(r,i,a,s,255,255,255),b=E(f(l.R,l.G,l.B,d.R,d.G,d.B)),p=q(e,t,o,n,0,0,0),g=q(r,i,a,s,0,0,0),m=E(f(p.R,p.G,p.B,g.R,g.G,g.B));return{delta:Math.max(b,m),maxDelta:N[c]}}return{delta:E(f(e,t,o,r,i,a)),maxDelta:N[c]}}var Tt=function(e){let t={};return function(o){return o in t||(t[o]=e(o)),t[o]}},mt=function(){let e=new OffscreenCanvas(1,1);e.width=e.height=1;let t=e.getContext("2d");if(!t)throw Error("unreachable code");return Tt(function(n){t.clearRect(0,0,1,1),t.fillStyle="#000",t.fillStyle=n;let r=t.fillStyle;if(t.fillStyle="#fff",t.fillStyle=n,r===t.fillStyle)return t.fillRect(0,0,1,1),[...t.getImageData(0,0,1,1).data]})}();function G(e,t){let o=mt(t);if(!o)throw new Error(`Invalid fallbackColor ${t!=null?JSON.stringify(t):t}`);return mt(e)||o}var M="yellow",O="red";function _t({img1:e,img2:t,width:o,height:n,algorithm:r="CIEDE2000"}){if(ot({img1:e,img2:t,width:o,height:n}),!J.includes(r))throw new Error(`Invalid algorithm ${r}, expected algorithms: ${J.join(", ")}.`);let i=o*n,a=new Uint8Array(i),s=new Uint32Array(e.buffer,e.byteOffset,i),c=new Uint32Array(t.buffer,t.byteOffset,i),f=!0;for(let u=0;u<i;u++){if(s[u]===c[u])continue;let l=u*4,{delta:d,maxDelta:b}=K(e,t,l,l,r);a[u]=Math.ceil(Math.abs(d)*100/b),f=!1}return{identical:f,diffMap:a}}function Yt(e){ot(e);let{img1:t,img2:o,width:n,height:r}=e,i=n*r,a=new Uint8Array(i),s=new Uint32Array(t.buffer,t.byteOffset,i),c=new Uint32Array(o.buffer,o.byteOffset,i);for(let f=0;f<r;f++)for(let u=0;u<n;u++){let l=f*n+u;s[l]===c[l]?a[l]=128:ht(t,u,f,n,r,o)||ht(o,u,f,n,r,t)?a[l]=193:a[l]=192}return a}function yt({img1:e,img2:t,output:o,diffMapOutput:n,width:r,height:i,threshold:a=10,antialias:s=!1,aaColor:c=M,diffColor:f=O,diffMask:u=!1,alpha:l=.1}){if(ot({img1:e,img2:t,width:r,height:i,output:o}),n&&n.length!==r*i)throw new Error("diffMapOutput data size does not match width/height.");if(e.length!==t.length||o&&o.length!==e.length)throw new Error("Image sizes do not match.");let{identical:d,diffMap:b}=_t({img1:e,img2:t,width:r,height:i,algorithm:"CIEDE2000"});if(d){if(o&&!u)for(let h=0,x=r*i;h<x;h++)xt(e,4*h,l,o);return{diffPixelAmount:0,aaPixelAmount:0}}let p=s?Yt({img1:e,img2:t,width:r,height:i}):null,[g,m,A]=G(c,M),[y,v,C]=G(f,O),_=0,L=0;for(let h=0;h<i;h++)for(let x=0;x<r;x++){let R=(h*r+x)*4;b[h*r+x]>a?p&&(p[h*r+x]&1)===1?(o&&et(o,R,g,m,A),n&&(n[h*r+x]=3),L++):(o&&et(o,R,y,v,C),n&&(n[h*r+x]=1),_++):(o&&!u&&xt(e,R,l,o),n&&(n[h*r+x]=0))}return{diffPixelAmount:_,aaPixelAmount:L}}function tt(e){return e instanceof Uint8Array||e instanceof Uint8ClampedArray}function ht(e,t,o,n,r,i){let a=Math.max(t-1,0),s=Math.max(o-1,0),c=Math.min(t+1,n-1),f=Math.min(o+1,r-1),u=(o*n+t)*4,l=t===a||t===c||o===s||o===f?1:0,d=0,b=0,p=n,g=r,m=0,A=0;for(let y=a;y<=c;y++)for(let v=s;v<=f;v++){if(y===t&&v===o)continue;let{delta:C}=K(e,e,u,(v*n+y)*4,"Brightness");if(C===0){if(l++,l>2)return!1}else C<d?(d=C,p=y,g=v):C>b&&(b=C,m=y,A=v)}return d===0||b===0?!1:H(e,p,g,n,r)&&H(i,p,g,n,r)||H(e,m,A,n,r)&&H(i,m,A,n,r)}function H(e,t,o,n,r){let i=Math.max(t-1,0),a=Math.max(o-1,0),s=Math.min(t+1,n-1),c=Math.min(o+1,r-1),f=(o*n+t)*4,u=t===i||t===s||o===a||o===c?1:0;for(let l=i;l<=s;l++)for(let d=a;d<=c;d++){if(l===t&&d===o)continue;let b=(d*n+l)*4;if(e[f]===e[b]&&e[f+1]===e[b+1]&&e[f+2]===e[b+2]&&e[f+3]===e[b+3]&&u++,u>2)return!0}return!1}function et(e,t,o,n,r){e[t+0]=o,e[t+1]=n,e[t+2]=r,e[t+3]=255}function xt(e,t,o,n){let r=e[t+0],i=e[t+1],a=e[t+2],s=o*e[t+3]/255,f=255+(I(r,i,a)-255)*s;et(n,t,f,f,f)}function ot({img1:e,img2:t,width:o,height:n,output:r}){if(!tt(e)||!tt(t)||r&&!tt(r))throw new Error("Image data: Uint8Array or Uint8ClampedArray expected.");if(e.length!==t.length)throw new Error("Image sizes do not match.");if(e.length!==o*n*4)throw new Error("Image data size does not match width/height.")}var wt=()=>{let e=document.createElement("template");return e.innerHTML=lt,wt=()=>e,e},Ct=()=>{let e=new CSSStyleSheet;return e.replaceSync(ct),Ct=()=>e,e},nt="img.left-side",rt="img.right-side",Ut=new IntersectionObserver(e=>{for(let t of e)At(t.target)}),Xt=new IntersectionObserver(e=>{for(let t of e){let o=t.target.getRootNode();if(!(o instanceof ShadowRoot))return;let{host:n}=o;if(!(n instanceof S))return;it(n)}}),Nt=new ResizeObserver(e=>{for(let t of e)At(t.target)}),T=new WeakMap,S=class extends HTMLElement{constructor(){super();let t=this.attachShadow({mode:"open"});t.adoptedStyleSheets=[Ct()];let o=wt();t.append(document.importNode(o.content,!0));let n=t.querySelector(".comparison-slider");n&&(Qt(n),Ut.observe(n),Nt.observe(n),t.querySelector(nt)?.addEventListener("load",()=>this.updateCanvas()),t.querySelector(rt)?.addEventListener("load",()=>this.updateCanvas()),T.set(this,{}),this.addEventListener("transitionstart",Ht))}connectedCallback(){let t=this.shadowRoot;if(!t)return;let o=this.querySelectorAll(":scope > img, :scope > figure > img");if(o.length>0){let n=o[0];if(n.parentElement?.matches("figure")){let r=n.parentElement?.querySelector(":scope > figcaption")?.textContent;t.querySelectorAll(".caption--left-side").forEach(i=>{i.textContent=r??""})}t.querySelectorAll(nt).forEach(r=>{r.src=n.src})}if(o.length>1){let n=o[1];if(n.parentElement?.matches("figure")){let r=n.parentElement?.querySelector(":scope > figcaption")?.textContent;t.querySelectorAll(".caption--right-side").forEach(i=>{i.textContent=r??""})}t.querySelectorAll(rt).forEach(r=>{r.src=n.src})}}updateCanvas(){let{shadowRoot:t}=this;if(!t)return;let o=t.querySelector(nt),n=t.querySelector(rt);!vt(o)||!vt(n)||(t.querySelectorAll("div.comparison-slider").forEach(r=>{r.style.width=`${o.naturalWidth}px`}),t.querySelectorAll("canvas.diff-image").forEach(r=>{let i=o.naturalWidth,a=o.naturalHeight;r.width=i,r.height=a;let c=new OffscreenCanvas(i,a).getContext("2d"),u=new OffscreenCanvas(i,a).getContext("2d"),l=r.getContext("2d");if(!c||!u||!l)return;c?.drawImage(o,0,0),u?.drawImage(n,0,0);let d=c.getImageData(0,0,i,a),b=u.getImageData(0,0,i,a),p=l.createImageData(i,a,{colorSpace:"srgb"}),g=new Uint8ClampedArray(i*a),m=T.get(this);m.diffMap=g,m.appliedAAColor=null,m.appliedDiffColor=null,m.diffs=yt({img1:d.data,img2:b.data,output:p.data,diffMapOutput:g,width:i,height:a,antialias:this.antialias}),this.setAttribute("data-diff-pixels",m.diffs.diffPixelAmount.toString()),this.antialias&&this.setAttribute("data-diff-antialias",m.diffs.aaPixelAmount.toString()),l.putImageData(p,0,0),it(this),Xt.observe(r)}))}get diffPixelsAmount(){return T.get(this).diffPixelAmount??NaN}get antialiasedPixelsAmount(){return T.get(this).aaPixelAmount??NaN}get antialias(){return this.hasAttribute("data-antialias")}set antialias(t){this.toggleAttribute("data-antialias",!!t)}};function Ht(e){let{target:t}=e;t instanceof S&&it(t)}function it(e){let t=T.get(e),{diffMap:o,appliedAAColor:n,appliedDiffColor:r}=t;if(!o)return;let i=getComputedStyle(e).getPropertyValue("--antialias-diff-color")||M,a=getComputedStyle(e).getPropertyValue("--diff-color")||O;if(i===n&&a===r)return;let{shadowRoot:s}=e;s&&s.querySelectorAll("canvas.diff-image").forEach(c=>{let f=c.getContext("2d");if(!f)return;let u=f.getImageData(0,0,c.width,c.height,{colorSpace:"srgb"});if(i!==n){let l=G(i,M);for(let d=0,b=o.length;d<b;d++)if(o[d]===3){let p=d*4,{data:g}=u;g[p]=l[0],g[p+1]=l[1],g[p+2]=l[2],g[p+3]=l[3]}t.appliedAAColor=i}if(a!==r){let l=G(a,O);for(let d=0,b=o.length;d<b;d++)if(o[d]===1){let p=d*4,{data:g}=u;g[p]=l[0],g[p+1]=l[1],g[p+2]=l[2],g[p+3]=l[3]}t.appliedDiffColor=a}f.putImageData(u,0,0)})}function vt(e){return e!=null&&e.complete&&e.naturalWidth!==0}function At(e){let t=e.querySelector(":scope > img"),o=e.querySelector(".resize img");if(!o||!t)return;let n=t.getBoundingClientRect().width+"px";o.style.width=n}function Qt(e){let t=e.querySelector("div.divider"),o=e.querySelector("div.resize");if(!t||!o)return;let n=0,r=0,i=0,a=0,s=0,c=function(f){f.pointerType==="mouse"&&f.preventDefault();let l=f.clientX-n;l<a?l=a:l>s&&(l=s);let d=(l+n/2-r)*100/i+"%";t.style.left=d,o.style.width=d};t.addEventListener("pointerdown",()=>{t.classList.add("dragging"),n=t.getBoundingClientRect().width,r=e.getBoundingClientRect().left,i=e.getBoundingClientRect().width,a=r+10,s=r+i-n-10,window.addEventListener("pointermove",c),window.addEventListener("pointerup",()=>{t.classList.remove("dragging"),window.removeEventListener("pointermove",c)},{once:!0})})}var Wt=new URL(import.meta.url),Et=Wt.searchParams.get("named")?.trim();Et&&customElements.define(Et,S);var jt=S,me=jt;export{jt as ImageComparisonElement,me as default};
//# sourceMappingURL=image-comparison.element.min.js.map
